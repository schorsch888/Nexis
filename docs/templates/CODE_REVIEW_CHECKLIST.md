# Code Review Checklist

**Reviewer:** @username  
**PR:** #XXX  
**Author:** @username  
**Date:** YYYY-MM-DD  

---

## 总体评价

**是否批准：**
- [ ] ✅ Approve - 可以合并
- [ ] 💬 Request Changes - 需要修改
- [ ] 🤔 Comment - 仅评论

**总体评分：** ⭐⭐⭐⭐⭐ (1-5)

---

## 1. 设计与架构 (Design & Architecture)

### 1.1 整体设计

- [ ] **设计合理** - 技术方案是否合理？有无过度设计？
- [ ] **符合架构** - 是否符合项目整体架构？
- [ ] **可扩展性** - 未来扩展是否方便？
- [ ] **可维护性** - 代码是否易于维护？

### 1.2 模块划分

- [ ] **职责清晰** - 每个模块职责单一明确？
- [ ] **耦合度** - 模块间耦合度是否合理？
- [ ] **依赖关系** - 依赖关系是否清晰合理？

### 1.3 API 设计

- [ ] **接口清晰** - API 是否易于理解和使用？
- [ ] **命名合理** - 函数/变量命名是否准确？
- [ ] **参数设计** - 参数设计是否合理？
- [ ] **错误处理** - 错误处理是否完整？

**Comments:**

---

## 2. 代码质量 (Code Quality)

### 2.1 可读性

- [ ] **代码清晰** - 代码是否易于理解？
- [ ] **命名规范** - 命名是否符合项目规范？
- [ ] **注释充分** - 关键逻辑是否有注释？
- [ ] **格式统一** - 代码格式是否统一（rustfmt）？

### 2.2 复杂度

- [ ] **函数长度** - 函数是否过长（> 50 行需拆分）？
- [ ] **圈复杂度** - 嵌套是否过深（> 3 层需重构）？
- [ ] **重复代码** - 是否有重复代码需要抽取？

### 2.3 最佳实践

- [ ] **Rust 惯用法** - 是否符合 Rust 最佳实践？
- [ ] **所有权/借用** - 所有权和借用是否正确？
- [ ] **错误处理** - 是否使用 Result/Option 而非 panic？
- [ ] **资源管理** - 资源是否正确释放？

**Comments:**

---

## 3. 测试 (Testing)

### 3.1 测试覆盖

- [ ] **单元测试** - 有足够的单元测试？
- [ ] **覆盖率** - 覆盖率是否 ≥ 80%？
- [ ] **边界条件** - 边界条件是否测试？
- [ ] **错误场景** - 错误场景是否测试？

### 3.2 测试质量

- [ ] **测试清晰** - 测试意图是否清晰？
- [ ] **测试独立** - 测试之间是否独立？
- [ ] **Mock 合理** - Mock 使用是否合理？
- [ ] **断言完整** - 断言是否充分？

### 3.3 测试运行

```bash
# 运行测试
cargo test <test_name>

# 测试结果
[Paste test output here]
```

- [ ] 所有测试通过
- [ ] 无 flaky test

**Comments:**

---

## 4. 性能 (Performance)

### 4.1 算法复杂度

- [ ] **时间复杂度** - 算法时间复杂度是否合理？
- [ ] **空间复杂度** - 内存使用是否合理？
- [ ] **I/O 操作** - I/O 操作是否优化？

### 4.2 资源使用

- [ ] **内存泄漏** - 是否有潜在的内存泄漏？
- [ ] **连接池** - 是否正确使用连接池？
- [ ] **缓存** - 是否合理使用缓存？

### 4.3 基准测试

- [ ] **性能基准** - 是否有基准测试？
- [ ] **无回退** - 性能是否无显著回退（> 5%）？

```bash
# 运行基准测试
cargo bench

# 结果对比
[Paste benchmark results]
```

**Comments:**

---

## 5. 安全性 (Security)

### 5.1 输入验证

- [ ] **输入检查** - 所有外部输入是否验证？
- [ ] **类型安全** - 类型转换是否安全？
- [ ] **边界检查** - 数组访问是否有边界检查？

### 5.2 认证授权

- [ ] **认证** - 认证逻辑是否正确？
- [ ] **授权** - 权限检查是否完整？
- [ ] **敏感数据** - 敏感数据是否加密/脱敏？

### 5.3 注入攻击

- [ ] **SQL 注入** - 是否防止 SQL 注入？
- [ ] **命令注入** - 是否防止命令注入？
- [ ] **XSS** - 是否防止 XSS？

### 5.4 依赖安全

```bash
# 运行安全审计
cargo audit

# 审计结果
[Paste audit results]
```

- [ ] 无已知漏洞依赖

**Comments:**

---

## 6. 错误处理 (Error Handling)

### 6.1 错误传播

- [ ] **错误类型** - 是否定义清晰的错误类型？
- [ ] **错误上下文** - 错误是否包含足够的上下文？
- [ ] **错误恢复** - 是否有合理的错误恢复机制？

### 6.2 日志记录

- [ ] **日志级别** - 日志级别是否合理（debug/info/warn/error）？
- [ ] **日志内容** - 日志信息是否有价值？
- [ ] **敏感信息** - 日志是否泄露敏感信息？

### 6.3 用户反馈

- [ ] **错误信息** - 用户看到的错误信息是否友好？
- [ ] **错误码** - 是否有明确的错误码？

**Comments:**

---

## 7. 文档 (Documentation)

### 7.1 代码注释

- [ ] **模块注释** - 模块级别是否有文档注释？
- [ ] **函数注释** - Public 函数是否有文档注释？
- [ ] **复杂逻辑** - 复杂逻辑是否有注释？

### 7.2 API 文档

- [ ] **cargo doc** - 文档是否正确生成？
- [ ] **示例代码** - 是否有使用示例？

```bash
# 生成文档
cargo doc --no-deps --open
```

### 7.3 README/CHANGELOG

- [ ] **README** - README 是否需要更新？
- [ ] **CHANGELOG** - CHANGELOG 是否已更新？
- [ ] **Migration Guide** - Breaking Changes 是否有迁移指南？

**Comments:**

---

## 8. 兼容性 (Compatibility)

### 8.1 向后兼容

- [ ] **API 兼容** - 是否保持 API 兼容？
- [ ] **数据兼容** - 是否保持数据格式兼容？
- [ ] **Breaking Changes** - Breaking Changes 是否标注并说明？

### 8.2 跨平台

- [ ] **平台兼容** - 代码是否跨平台（Linux/macOS/Windows）？
- [ ] **依赖兼容** - 依赖是否跨平台？

### 8.3 版本兼容

- [ ] **Rust 版本** - 是否符合项目 Rust 版本要求（1.75+）？
- [ ] **依赖版本** - 依赖版本是否兼容？

**Comments:**

---

## 9. 代码规范 (Code Style)

### 9.1 格式化

```bash
cargo fmt -- --check
```

- [ ] **rustfmt** - 代码格式符合 rustfmt 标准

### 9.2 Lint

```bash
cargo clippy -- -D warnings
```

- [ ] **clippy** - 无 clippy 警告

### 9.3 命名规范

- [ ] **变量命名** - snake_case
- [ ] **类型命名** - PascalCase
- [ ] **常量命名** - SCREAMING_SNAKE_CASE
- [ ] **模块命名** - snake_case

**Comments:**

---

## 10. 特定关注点 (Specific Concerns)

<!-- 针对本次 PR 的特殊关注点 -->

### 10.1 业务逻辑

- [ ] 业务逻辑是否正确？
- [ ] 边界条件是否处理？

### 10.2 并发安全

- [ ] 是否有并发问题？
- [ ] 是否正确使用锁/Mutex？
- [ ] 是否有死锁风险？

### 10.3 资源清理

- [ ] 是否正确释放资源？
- [ ] 是否有资源泄漏风险？

**Comments:**

---

## Review Summary

### 优点

- ...
- ...

### 需要改进

- ...
- ...

### 阻塞问题 (Blocking Issues)

- [ ] 问题 1: 描述
- [ ] 问题 2: 描述

### 建议 (Non-blocking Suggestions)

- 建议 1: 描述
- 建议 2: 描述

---

## 最终决定

**Reviewer Decision:**
- [ ] ✅ **Approve** - LGTM，可以合并
- [ ] 💬 **Request Changes** - 请修改上述问题
- [ ] 🤔 **Comment** - 仅评论，不阻塞

**Reviewer:** @username  
**Date:** YYYY-MM-DD  

---

## 后续行动

- [ ] 所有问题已解决
- [ ] 所有对话已 resolved
- [ ] CI 全部通过
- [ ] 准备合并
